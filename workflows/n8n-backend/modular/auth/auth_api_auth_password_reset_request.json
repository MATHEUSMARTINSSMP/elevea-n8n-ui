{
  "name": "auth_api_auth_password_reset_request",
  "description": "Workflow modular para api/auth/password-reset-request - MÃ³dulo AUTH",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "api/auth/password-reset-request",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-password-reset-request",
      "name": "ðŸ”‘ Webhook - Password Reset Request",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [
        260,
        1100
      ],
      "webhookId": "elevea-password-reset-request"
    },
    {
      "parameters": {
        "jsCode": "// FUNÃ‡ÃƒO: password_reset_request (do GAS)\nconst out = [];\nfor (const { json } of items) {\n  const { email } = json.body || {};\n  \n  if (!email || !email.includes('@')) {\n    out.push({\n      json: {\n        success: false,\n        error: 'Email vÃ¡lido Ã© obrigatÃ³rio',\n        timestamp: new Date().toISOString()\n      }\n    });\n    continue;\n  }\n  \n  const resetToken = require('crypto').randomBytes(32).toString('hex');\n  const resetLink = `https://agenciaelevea.netlify.app/reset?token=${resetToken}`;\n  const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString();\n  \n  out.push({ \n    json: { \n      success: true,\n      email: email.toLowerCase().trim(), \n      resetToken: resetToken, \n      resetLink: resetLink,\n      expiresAt: expiresAt,\n      message: 'Link de reset enviado por email',\n      timestamp: new Date().toISOString()\n    } \n  });\n}\nreturn out;"
      },
      "id": "code-password-reset-request",
      "name": "ðŸ”‘ Code - Password Reset Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        460,
        1100
      ]
    },
    {
      "parameters": {
        "url": "https://api.resend.com/emails",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"from\": \"noreply@elevea.com\",\n  \"to\": [ $json.email ],\n  \"subject\": \"ðŸ”‘ Reset de Senha - ELEVEA\",\n  \"html\": \"<div style='font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;'>\" +\n    \"<h2 style='color: #333; text-align: center;'>ðŸ”‘ Reset de Senha</h2>\" +\n    \"<p>OlÃ¡!</p>\" +\n    \"<p>Recebemos uma solicitaÃ§Ã£o para resetar sua senha na plataforma ELEVEA.</p>\" +\n    \"<div style='text-align: center; margin: 30px 0;'>\" +\n      \"<a href='\" + $json.resetLink + \"' style='background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; display: inline-block;'>Resetar Senha</a>\" +\n    \"</div>\" +\n    \"<p>Este link expira em 24 horas.</p>\" +\n    \"<p>Se vocÃª nÃ£o solicitou, ignore este email.</p>\" +\n    \"<hr style='margin: 30px 0; border: none; border-top: 1px solid #eee;'>\" +\n    \"<p style='color: #666; font-size: 12px; text-align: center;'>Equipe ELEVEA</p>\" +\n    \"</div>\"\n} }}",
        "options": {}
      },
      "id": "http-resend-reset-email",
      "name": "ðŸ“§ HTTP - Resend Reset Email",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        660,
        1100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'Email de reset enviado', timestamp: new Date().toISOString() } }}",
        "options": {
          "headers": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "respond-password-reset-request",
      "name": "ðŸ“¤ Respond - Password Reset Request",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        860,
        1100
      ]
    }
  ],
  "connections": {
    "webhook-password-reset-request": {
      "main": [
        [
          {
            "node": "code-password-reset-request",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-password-reset-request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "code-password-reset-request": {
      "main": [
        [
          {
            "node": "http-resend-reset-email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "http-resend-reset-email": {
      "main": [
        [
          {
            "node": "respond-password-reset-request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    "modular",
    "elevea",
    "auth"
  ]
}