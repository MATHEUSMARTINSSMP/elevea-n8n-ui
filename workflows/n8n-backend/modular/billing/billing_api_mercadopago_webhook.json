{
  "name": "billing_api_mercadopago_webhook",
  "description": "Workflow modular para api/mercadopago/webhook - M√≥dulo BILLING",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "api/mercadopago/webhook",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-mercadopago",
      "name": "üí∞ Webhook - Mercado Pago",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [
        260,
        2100
      ],
      "webhookId": "elevea-mercadopago"
    },
    {
      "parameters": {
        "jsCode": "// FUN√á√ÉO: mercadopago_webhook / mp_ (do GAS) - PROCESSAMENTO COMPLETO\nconst out = [];\nfor (const { json } of items) {\n  const body = json.body || {};\n  const { type, action, data } = body;\n  \n  // Eventos do Mercado Pago\n  const eventType = type || action;\n  \n  if (!eventType) {\n    out.push({\n      json: {\n        success: false,\n        error: 'Evento n√£o identificado',\n        timestamp: new Date().toISOString()\n      }\n    });\n    continue;\n  }\n  \n  // Processar diferentes tipos de eventos\n  if (eventType === 'subscription_authorized' || eventType === 'payment.approved') {\n    const siteSlug = data?.external_reference || data?.metadata?.site_slug || 'unknown';\n    out.push({\n      json: {\n        eventType: 'subscription_authorized',\n        siteSlug: siteSlug,\n        newPlan: 'vip',\n        newStatus: 'active',\n        preapprovalId: data?.id || data?.preapproval_id,\n        amount: data?.transaction_amount || 97,\n        paymentDate: new Date().toISOString(),\n        action: 'activate',\n        timestamp: new Date().toISOString()\n      }\n    });\n  } else if (eventType === 'subscription_paused' || eventType === 'subscription_cancelled' || eventType === 'payment.cancelled') {\n    const siteSlug = data?.external_reference || data?.metadata?.site_slug || 'unknown';\n    out.push({\n      json: {\n        eventType: eventType,\n        siteSlug: siteSlug,\n        newPlan: 'essential',\n        newStatus: 'blocked',\n        preapprovalId: data?.id || data?.preapproval_id,\n        action: 'block',\n        reason: 'Assinatura cancelada/pausada',\n        timestamp: new Date().toISOString()\n      }\n    });\n  } else if (eventType === 'payment_created' || eventType === 'payment.created') {\n    const siteSlug = data?.external_reference || data?.metadata?.site_slug || 'unknown';\n    out.push({\n      json: {\n        eventType: 'payment_created',\n        siteSlug: siteSlug,\n        paymentId: data?.id,\n        amount: data?.transaction_amount,\n        status: 'pending',\n        action: 'log_only',\n        timestamp: new Date().toISOString()\n      }\n    });\n  } else {\n    out.push({\n      json: {\n        eventType: 'unknown',\n        rawData: body,\n        action: 'log_only',\n        timestamp: new Date().toISOString()\n      }\n    });\n  }\n}\nreturn out;"
      },
      "id": "code-process-mercadopago",
      "name": "üí∞ Code - Process Mercado Pago",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        460,
        2100
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.action }}",
              "operation": "equals",
              "value2": "activate"
            }
          ]
        }
      },
      "id": "if-mp-action",
      "name": "üîÄ IF - MP Action",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        660,
        2100
      ]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appELEVEA",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "billing",
          "mode": "list"
        },
        "filterByFormula": "=AND({siteSlug}='{{ $json.siteSlug }}')",
        "options": {}
      },
      "id": "airtable-search-billing-mp",
      "name": "üóÑÔ∏è Airtable - Search Billing MP",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        860,
        2000
      ]
    },
    {
      "parameters": {
        "jsCode": "// Preparar update ou insert de billing\nconst out = [];\nfor (const { json } of items) {\n  const hasRecord = json.id ? true : false;\n  out.push({\n    json: {\n      hasRecord,\n      recordId: json.id || null,\n      siteSlug: json.siteSlug,\n      preapprovalId: json.preapprovalId,\n      paymentDate: json.paymentDate,\n      amount: json.amount,\n      status: json.eventType === 'subscription_authorized' ? 'authorized' : 'paused',\n      provider: 'mercadopago'\n    }\n  });\n}\nreturn out;"
      },
      "id": "code-prepare-billing-update",
      "name": "üìù Code - Prepare Billing Update",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1060,
        2000
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.hasRecord }}",
              "value2": true
            }
          ]
        }
      },
      "id": "if-billing-exists",
      "name": "üîÄ IF - Billing Exists",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1260,
        2000
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "appELEVEA",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "billing",
          "mode": "list"
        },
        "id": "={{ $json.recordId }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "preapproval_id",
              "fieldValue": "={{ $json.preapprovalId }}"
            },
            {
              "fieldName": "payment_date",
              "fieldValue": "={{ $json.paymentDate }}"
            },
            {
              "fieldName": "amount",
              "fieldValue": "={{ $json.amount }}"
            },
            {
              "fieldName": "status",
              "fieldValue": "={{ $json.status }}"
            },
            {
              "fieldName": "updated_at",
              "fieldValue": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "id": "airtable-update-billing",
      "name": "üóÑÔ∏è Airtable - Update Billing",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        1460,
        1900
      ]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appELEVEA",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "clients",
          "mode": "list"
        },
        "filterByFormula": "=AND({siteSlug}='{{ $json.siteSlug }}')",
        "options": {}
      },
      "id": "airtable-search-client-mp",
      "name": "üóÑÔ∏è Airtable - Search Client MP",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        1660,
        2000
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "appELEVEA",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "clients",
          "mode": "list"
        },
        "id": "={{ $json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "plan",
              "fieldValue": "={{ $json.newPlan }}"
            },
            {
              "fieldName": "status",
              "fieldValue": "={{ $json.newStatus }}"
            },
            {
              "fieldName": "preapproval_id",
              "fieldValue": "={{ $json.preapprovalId }}"
            },
            {
              "fieldName": "last_payment",
              "fieldValue": "={{ $json.paymentDate }}"
            },
            {
              "fieldName": "updated_at",
              "fieldValue": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "id": "airtable-update-client-mp",
      "name": "üóÑÔ∏è Airtable - Update Client MP",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        1860,
        2000
      ]
    },
    {
      "parameters": {
        "jsCode": "// Preparar notifica√ß√£o de mudan√ßa de plano\nconst out = [];\nfor (const { json } of items) {\n  const fields = json.fields || {};\n  const isActivation = json.newStatus === 'active';\n  \n  out.push({\n    json: {\n      siteSlug: fields.siteSlug || json.siteSlug,\n      email: fields.email,\n      name: fields.name,\n      newPlan: json.newPlan,\n      newStatus: json.newStatus,\n      isActivation: isActivation,\n      emailSubject: isActivation ? 'üéâ Bem-vindo ao Plano VIP - ELEVEA' : '‚ö†Ô∏è Assinatura Cancelada - ELEVEA',\n      emailMessage: isActivation \n        ? 'Parab√©ns! Seu plano VIP foi ativado com sucesso. Agora voc√™ tem acesso a todas as funcionalidades premium!' \n        : 'Sua assinatura foi cancelada. Voc√™ foi movido para o plano Essential com funcionalidades limitadas.',\n      timestamp: new Date().toISOString()\n    }\n  });\n}\nreturn out;"
      },
      "id": "code-prepare-mp-notification",
      "name": "üìß Code - Prepare MP Notification",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2060,
        2000
      ]
    },
    {
      "parameters": {
        "url": "https://api.resend.com/emails",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"from\": \"noreply@elevea.com\",\n  \"to\": [ $json.email ],\n  \"subject\": $json.emailSubject,\n  \"html\": \"<div style='font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;'>\" +\n    \"<h2 style='color: #333; text-align: center;'>\" + $json.emailSubject + \"</h2>\" +\n    \"<p>Ol√° \" + ($json.name || 'Cliente') + \"!</p>\" +\n    \"<p>\" + $json.emailMessage + \"</p>\" +\n    \"<div style='background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 5px;'>\" +\n      \"<p><strong>Detalhes:</strong></p>\" +\n      \"<ul>\" +\n        \"<li>Site: \" + $json.siteSlug + \"</li>\" +\n        \"<li>Plano: \" + $json.newPlan.toUpperCase() + \"</li>\" +\n        \"<li>Status: \" + ($json.isActivation ? 'Ativo ‚úÖ' : 'Bloqueado ‚ùå') + \"</li>\" +\n      \"</ul>\" +\n    \"</div>\" +\n    ($json.isActivation ? \n      \"<div style='text-align: center; margin: 30px 0;'>\" +\n        \"<a href='https://agenciaelevea.netlify.app/dashboard' style='background: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; display: inline-block;'>Acessar Dashboard</a>\" +\n      \"</div>\" : \n      \"<div style='text-align: center; margin: 30px 0;'>\" +\n        \"<a href='https://agenciaelevea.netlify.app/upgrade' style='background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; display: inline-block;'>Reativar Plano VIP</a>\" +\n      \"</div>\"\n    ) +\n    \"<hr style='margin: 30px 0; border: none; border-top: 1px solid #eee;'>\" +\n    \"<p style='color: #666; font-size: 12px; text-align: center;'>Equipe ELEVEA</p>\" +\n    \"</div>\"\n} }}",
        "options": {}
      },
      "id": "http-resend-mp-notification",
      "name": "üìß HTTP - Resend MP Notification",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2260,
        2000
      ]
    },
    {
      "parameters": {
        "url": "https://api.telegram.org/bot{{ $env.TELEGRAM_BOT_TOKEN }}/sendMessage",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"chat_id\": $env.TELEGRAM_CHAT_ID,\n  \"text\": \"üí∞ Mercado Pago - \" + ($json.isActivation ? 'ATIVA√á√ÉO' : 'CANCELAMENTO') + \"\\n\\n\" +\n    \"Site: \" + $json.siteSlug + \"\\n\" +\n    \"Plano: \" + $json.newPlan.toUpperCase() + \"\\n\" +\n    \"Status: \" + $json.newStatus + \"\\n\" +\n    \"Email: \" + $json.email + \"\\n\" +\n    \"Timestamp: \" + new Date().toISOString(),\n  \"parse_mode\": \"HTML\"\n} }}",
        "options": {}
      },
      "id": "http-telegram-mp-alert",
      "name": "üì± HTTP - Telegram MP Alert",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2460,
        2000
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.isActivation }}",
              "value2": true
            }
          ]
        }
      },
      "id": "if-mp-activation",
      "name": "üîÄ IF - MP Activation",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        2660,
        2000
      ]
    },
    {
      "parameters": {
        "url": "https://api.netlify.com/build_hooks/{{ $env.NETLIFY_BUILD_HOOK }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"trigger_title\": \"Site ativado: \" + $json.siteSlug,\n  \"trigger_branch\": \"main\"\n} }}",
        "options": {}
      },
      "id": "http-netlify-rebuild-activate",
      "name": "üèóÔ∏è HTTP - Netlify Rebuild (Activate)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2860,
        1900
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "base": {
          "__rl": true,
          "value": "appELEVEA",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "audit_logs",
          "mode": "list"
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "site_slug",
              "fieldValue": "={{ $json.siteSlug }}"
            },
            {
              "fieldName": "action",
              "fieldValue": "={{ $json.action }}"
            },
            {
              "fieldName": "user_email",
              "fieldValue": "system"
            },
            {
              "fieldName": "user_role",
              "fieldValue": "system"
            },
            {
              "fieldName": "details",
              "fieldValue": "={{ $json.details }}"
            },
            {
              "fieldName": "severity",
              "fieldValue": "={{ $json.severity }}"
            }
          ]
        }
      },
      "id": "airtable-insert-audit-mp",
      "name": "üóÑÔ∏è Airtable - Insert Audit MP",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        3060,
        2000
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'Webhook Mercado Pago processado', siteSlug: $json.siteSlug, action: $json.action, timestamp: new Date().toISOString() } }}",
        "options": {
          "headers": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "respond-mercadopago",
      "name": "üì§ Respond - Mercado Pago",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        3260,
        2000
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üîÄ IF - MP Activation processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-if-mp-activation",
      "name": "üì§ Respond - MP Activation",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "jsCode": "// Log de bloqueio do site\nconst out = [];\nfor (const { json } of items) {\n  out.push({\n    json: {\n      siteSlug: json.siteSlug,\n      action: 'site_blocked_payment_failed',\n      user_email: 'system',\n      user_role: 'system',\n      details: JSON.stringify({ reason: json.reason, eventType: json.eventType }),\n      severity: 'critical',\n      timestamp: new Date().toISOString()\n    }\n  });\n}\nreturn out;"
      },
      "id": "code-audit-site-blocked",
      "name": "üìù Code - Audit Site Blocked",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2860,
        2100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üì± HTTP - Telegram MP Alert processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-http-telegram-mp-alert",
      "name": "üì§ Respond - Telegram MP Alert",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üìß HTTP - Resend MP Notification processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-http-resend-mp-notification",
      "name": "üì§ Respond - Resend MP Notification",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üìß Code - Prepare MP Notification processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-code-prepare-mp-notification",
      "name": "üì§ Respond - Prepare MP Notification",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üóÑÔ∏è Airtable - Update Client MP processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-airtable-update-client-mp",
      "name": "üì§ Respond - Update Client MP",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üóÑÔ∏è Airtable - Search Client MP processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-airtable-search-client-mp",
      "name": "üì§ Respond - Search Client MP",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üóÑÔ∏è Airtable - Update Billing processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-airtable-update-billing",
      "name": "üì§ Respond - Update Billing",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üîÄ IF - Billing Exists processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-if-billing-exists",
      "name": "üì§ Respond - Billing Exists",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "base": {
          "__rl": true,
          "value": "appELEVEA",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "billing",
          "mode": "list"
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "site_slug",
              "fieldValue": "={{ $json.siteSlug }}"
            },
            {
              "fieldName": "preapproval_id",
              "fieldValue": "={{ $json.preapprovalId }}"
            },
            {
              "fieldName": "payment_date",
              "fieldValue": "={{ $json.paymentDate }}"
            },
            {
              "fieldName": "amount",
              "fieldValue": "={{ $json.amount }}"
            },
            {
              "fieldName": "status",
              "fieldValue": "={{ $json.status }}"
            },
            {
              "fieldName": "provider",
              "fieldValue": "mercadopago"
            }
          ]
        }
      },
      "id": "airtable-insert-billing",
      "name": "üóÑÔ∏è Airtable - Insert Billing",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [
        1460,
        2100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üóÑÔ∏è Airtable - Insert Billing processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-airtable-insert-billing",
      "name": "üì§ Respond - Insert Billing",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üìù Code - Prepare Billing Update processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-code-prepare-billing-update",
      "name": "üì§ Respond - Prepare Billing Update",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üóÑÔ∏è Airtable - Search Billing MP processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-airtable-search-billing-mp",
      "name": "üì§ Respond - Search Billing MP",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üîÄ IF - MP Action processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-if-mp-action",
      "name": "üì§ Respond - MP Action",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'üí∞ Code - Process Mercado Pago processado', timestamp: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "respond-code-process-mercadopago",
      "name": "üì§ Respond - Process Mercado Pago",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        100
      ]
    }
  ],
  "connections": {
    "webhook-mercadopago": {
      "main": [
        [
          {
            "node": "code-process-mercadopago",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-mercadopago",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "code-process-mercadopago": {
      "main": [
        [
          {
            "node": "if-mp-action",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-code-process-mercadopago",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "if-mp-action": {
      "main": [
        [
          {
            "node": "airtable-search-billing-mp",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-if-mp-action",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "respond-mercadopago",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "airtable-search-billing-mp": {
      "main": [
        [
          {
            "node": "code-prepare-billing-update",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-airtable-search-billing-mp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "code-prepare-billing-update": {
      "main": [
        [
          {
            "node": "if-billing-exists",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-code-prepare-billing-update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "if-billing-exists": {
      "main": [
        [
          {
            "node": "airtable-update-billing",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-if-billing-exists",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "airtable-insert-billing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "airtable-update-billing": {
      "main": [
        [
          {
            "node": "airtable-search-client-mp",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-airtable-update-billing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "airtable-search-client-mp": {
      "main": [
        [
          {
            "node": "airtable-update-client-mp",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-airtable-search-client-mp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "airtable-update-client-mp": {
      "main": [
        [
          {
            "node": "code-prepare-mp-notification",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-airtable-update-client-mp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "code-prepare-mp-notification": {
      "main": [
        [
          {
            "node": "http-resend-mp-notification",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-code-prepare-mp-notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "http-resend-mp-notification": {
      "main": [
        [
          {
            "node": "http-telegram-mp-alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-http-resend-mp-notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "http-telegram-mp-alert": {
      "main": [
        [
          {
            "node": "if-mp-activation",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-http-telegram-mp-alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "if-mp-activation": {
      "main": [
        [
          {
            "node": "http-netlify-rebuild-activate",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-if-mp-activation",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "code-audit-site-blocked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "http-netlify-rebuild-activate": {
      "main": [
        [
          {
            "node": "airtable-insert-audit-mp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "airtable-insert-audit-mp": {
      "main": [
        [
          {
            "node": "respond-mercadopago",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "code-audit-site-blocked": {
      "main": [
        [
          {
            "node": "airtable-insert-audit-mp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "airtable-insert-billing": {
      "main": [
        [
          {
            "node": "airtable-search-client-mp",
            "type": "main",
            "index": 0
          },
          {
            "node": "respond-airtable-insert-billing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    "modular",
    "elevea",
    "billing"
  ]
}